<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Healthy Consultation</title>
	<link rel="stylesheet" href="/RequestDisPatcher/CSS/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="/RequestDisPatcher/CSS/layout.css">
	<link rel="stylesheet" type="text/css" href="/RequestDisPatcher/CSS/global.css">
	<link rel="stylesheet" type="text/css" href="/RequestDisPatcher/CSS/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="/RequestDisPatcher/CSS/number-pb.css">
	<script src="http://libs.baidu.com/jquery/2.0.0/jquery.js"></script>
	<script src="/RequestDisPatcher/JS/xcConfirm.js"></script>
	<link rel="stylesheet" type="text/css" href="/RequestDisPatcher/CSS/xcConfirm.css"/>
	<!--<link href='http://fonts.googleapis.com/css?family=Quicksand' rel='stylesheet' type='text/css'>-->
	<script src="/RequestDisPatcher/amcharts/amcharts.js"></script>
	<script src="/RequestDisPatcher/amcharts/serial.js"></script>
	<script src="/RequestDisPatcher/amcharts/themes/light.js"></script>
	<script src="http://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="/RequestDisPatcher/JS/birthday.js"></script>
	<script src="/RequestDisPatcher/JS/radialIndicator.js"></script>
	<script src="/RequestDisPatcher/JS/jquery.velocity.min.js"></script>
	<script src="/RequestDisPatcher/JS/number-pb.js"></script>
	<script src="/RequestDisPatcher/JS/DateFormat.js"></script>

	<style>
		#chartdiv ,#chartdiv1,#chartdiv2,#chartdiv3{
			width: 590px;
			height	:300px;
		}

		.number-pb .number-pb-num {
			position: absolute;
			/* background-color: #fff; */
			/* left: 4px; */
			top: 30px;
			/* padding: 16px 12px; */
			width: 54px;
			left: 19%;
			background: none !important;
			font-family:华文细黑,STHeiti,MingLiu;
		}

		.showgotoBed{
			font-weight: normal !important;

			line-height: 123px!important;
			font-family:华文细黑,STHeiti,MingLiu;

		}

		.showgotoBed.outOfBed{
			font-weight: normal !important;

			line-height: 123px!important;
			font-family:华文细黑,STHeiti,MingLiu;
			margin-right: 20px;
			display: inline-block;
			float: right;
		}
		.showgotoBed.tosleep{
			font-weight: normal !important;

			line-height: 123px!important;
			font-family:华文细黑,STHeiti,MingLiu;
			margin-left: 50px;
			display: inline-block;
			float: left;
		}

		.qc{
			position: absolute;
			z-index: 4;

			left:-21px !important;
		}


	</style>

</head>
<body>
<div class="holder rep ">
	<div class="left_nav">
		<div class="header_text">
			<div class="header_text_right">
				<span class="header_pic"><a href="modify.html" ><img src="Heads/default.jpg" id="head"></a></span>
			</div>
		</div>
		<ul>
			<a href="login.html"><li onclick="quit()"  >退出登录</li></a>
			<a href="real.html"><li>实时数据</li></a>
			<a href="healthy.html"><li class="on">健康档案</li></a>
			<a href="addProduct.html"><li>添加或更改设备</li></a>
			<a href="deleteProduct.html"><li>删除设备</li></a>
		</ul>
	</div>
	<div class="right_show">
		<h3>isleep</h3>
		<a href="homepage.html"><span class="glyphicon glyphicon-home"></span></a>
		<div class="show_detail">
			<div class="show_detail_data" style="    padding-top: 40px;">
				<div class="data_table search">
					<ul class="search_list report" >
						<li class="clickC">查询单次睡眠</li>
						<li>查询多次睡眠</li>
					</ul>
					<div class="report">
						<div class="report_detail">
							<h4 class="">监测报告</h4>
							<h5>监测日期：</h5>
							<div class="circle">
								<ul>
									<li><span class="showxl"></span><span>次/分</span><span>平均心率</span></li>
									<li><span class="showhxl"></span><span>次/分</span><span>平均呼吸率</span></li>
									<li>
										<div id="indicatorContainer4">
										</div>
										<span class="pf">睡眠评分</span>
									</li>
									<li><span class="showfscs"></span><span>次/分</span><span>翻身次数</span></li>
									<li><span class="showqycs"></span><span>次/分</span><span>起夜次数</span></li>
								</ul>
							</div>
							<div class="line">
								<ul>
									<li>
										<i class="sc"><span>上床</span></i>

										<section id="sample-pb">
											<article>
												<div class="number-pb rumian">
													<div class="number-pb-shown "><i class="icon_sleepright">入眠</i></div>

												</div>
											</article>
										</section>
										<i class="qc"><span>起床</span></i>
									</li>
									<li>
										<section id="sample-pb1">
											<article>
												<div class="number-pb">
													<div class="number-pb-shown"><i class="icon_sleepright">深睡</i></div>
													<!--<div class="number-pb-num">深睡</div>-->
												</div>
											</article>
										</section>

									</li>
									<li>
										<section id="sample-pb2">
											<article>
												<div class="number-pb">
													<div class="number-pb-shown"><i class="icon_sleepright">浅睡</i></div>
													<!--<div class="number-pb-num">浅睡</div>-->
												</div>
											</article>
										</section>

									</li>
									<li>
										<section id="sample-pb3">
											<article>
												<div class="number-pb">
													<div class="number-pb-shown"><i class="icon_sleepright">总长</i></div>
													<!--<div class="number-pb-num">总长</div>-->
												</div>
											</article>
										</section>

									</li>
								</ul>
							</div>
							<input type="button" onclick="javascript:history.back(-1);" value="Back" class="submit_submit back">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	function quit() {
		$.ajax({
			type:"post",
			url:"/RequestDisPatcher/request/dispatcher.do",
			data: {
				url:"http://127.0.0.1:9001/login/logout",
				params:"token="+token
			},
			success: function (data) {
				alert(data.Message);
//
			},
			error: function (data) {
				alert('fail');
			}
		});
	}

	function getQueryString(name) {
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
		var r = window.location.search.substr(1).match(reg);
		if (r != null) return unescape(r[2]);
		return null;
	}

	$(".right_show").css("border-bottom", '1px solid #ddd');
	$(".right_show").css("padding-bottom", 30);


	var otheremail=getQueryString('otheremail');
	console.log(otheremail);

	$(document).ready(function() {
		var userInfo = document.cookie.match(new RegExp("(^| )userData=([^;]*)(;|$)"));
//            console.log(userInfo);
		var info = JSON.parse(userInfo[2]);
		var Info = info['userInfo'];
		var token = info.token;
		var gender = info.gender;

		var gender = Info.gender;

		var  image=Info.image;

		if(image==null){
			if(gender==1){

				$('#head').attr('src','Heads/header_man.png');

			}else if(gender==0){

				$('#head').attr('src','Heads/header_woman.png');

			}

		}else{
			$('#head').attr('src',image);
		}

		var time = getQueryString('time');

if(otheremail==null){
	var timetoshow=time.split('/');
		$.ajax({
			type: "post",
			dataType: "json",
			url: "/RequestDisPatcher/request/dispatcher.do",
			data: {
				url: "http://101.37.100.209:9002/device/getRealData",
				params: "token=" + token + "&time=" + time
			},
			success: function (data) {
				console.log(data);
				$('.report_detail h5').append('<span>'+timetoshow[0]+'月'+timetoshow[1]+'日'+'</span>');
				var radialObj4 = $('#indicatorContainer4').radialIndicator({
					barColor: {
						0: '#8A847F',
						33: '#8A847F',
						66: '#8A847F',
						100: '#8A847F'
					},
					fontColor: '#000',
					percentage: true
				}).data('radialIndicator');
				radialObj4.animate(data.Data[0].score);

				$('.showxl').text(data.Data[0].avgHeart);
				$('.showhxl').text(data.Data[0].avgBreath);
				$('.showfscs').text(data.Data[0].turnNum);
				$('.showqycs').text(data.Data[0].outNum);

				var allSleepTime=MillisecondToDate((data.Data[0].lightSleepTime+data.Data[0].deepSleepTime)*1000);


				var deepSleepTime=MillisecondToDate((data.Data[0].deepSleepTime)*1000);

				var lightSleepTime=MillisecondToDate((data.Data[0].lightSleepTime)*1000);


				$('#sample-pb1').append('<p>深度睡眠时长:'+ deepSleepTime +'</p>');
				$('#sample-pb2').append('<p>浅度睡眠时长:'+ lightSleepTime +'</p>');
				$('#sample-pb3').append('<p>总睡眠时长:'+ allSleepTime +'</p>');

				//上床到开始睡眠比例

//				var num=((data.Data[0].goToBed)*1000/(data.Data[0].sleepEnd-data.Data[0].sleepStart))*100;

				var num=((data.Data[0].sleepStart-data.Data[0].goToBed)/(data.Data[0].outOfBed-data.Data[0].goToBed))*100;

				console.log(num);
				//深度睡眠比例
				var num1=((data.Data[0].deepSleepTime)/(data.Data[0].lightSleepTime+data.Data[0].deepSleepTime))*100;


				//浅度睡眠比例
				var num2=((data.Data[0].lightSleepTime)/(data.Data[0].lightSleepTime+data.Data[0].deepSleepTime))*100;

				var date_sleepStart = new Date(parseInt(data.Data[0].sleepStart));
				var date_fmt_sleepStart=date_sleepStart.format(" hh:mm");

				$('.number-pb.rumian').append('<span class="showgotoBed tosleep">'+date_fmt_sleepStart+'</span>');

				var date_goToBed = new Date(parseInt(data.Data[0].goToBed));
				var date_fmt_goToBed=date_goToBed.format(" hh:mm");
				$('.sc').append('<span class="showgotoBed">'+date_fmt_goToBed+'</span>');


				var date_outOfBed = new Date(parseInt(data.Data[0].outOfBed));
				var date_fmt_outOfBed=date_outOfBed.format(" hh:mm");
				$('.qc').append('<span class="showgotoBed outOfBed">'+date_fmt_outOfBed+'</span>');

if(data.Data[0].score!=0){
	var num=20;
	var num3 = 100;
	var controlBar = $('#sample-pb .number-pb').NumberProgressBar({
		duration: 3000,
		percentage: num
	});

	var controlBar3 = $('#sample-pb3 .number-pb').NumberProgressBar({
		duration: 3000,
		percentage: num3
	});

}else{


	var num = 0;

	var num3 = 0;
	var controlBar = $('#sample-pb .number-pb').NumberProgressBar({
		duration: 3000,
		percentage: num
	});

	var controlBar3 = $('#sample-pb3 .number-pb').NumberProgressBar({
		duration: 3000,
		percentage: num3
	});

}



				var controlBar1 = $('#sample-pb1 .number-pb').NumberProgressBar({
					duration: 3000,
					percentage: num1
				});

				var controlBar2 = $('#sample-pb2 .number-pb').NumberProgressBar({
					duration: 3000,
					percentage: num2
				});


			},
			error: function (data) {
				console.log(data);
				var txt = data.Message;
				window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.confirm);
			}
		});
}else{
	var timetoshow=time.split('/');
	$.ajax({
		type: "post",
		dataType: "json",
		url: "/RequestDisPatcher/request/dispatcher.do",
		data: {
			url: "http://101.37.100.209:9002/device/getOtherRealData",
			params: "token=" + token + "&time=" + time+"&email=" + otheremail
		},
		success: function (data) {
			console.log(data);
			$('.report_detail h5').append('<span>'+timetoshow[0]+'月'+timetoshow[1]+'日'+'</span>');
			var radialObj4 = $('#indicatorContainer4').radialIndicator({
				barColor: {
					0: '#8A847F',
					33: '#8A847F',
					66: '#8A847F',
					100: '#8A847F'
				},
				fontColor: '#000',
				percentage: true
			}).data('radialIndicator');
			radialObj4.animate(data.Data[0].score);

			$('.showxl').text(data.Data[0].avgHeart);
			$('.showhxl').text(data.Data[0].avgBreath);
			$('.showfscs').text(data.Data[0].turnNum);
			$('.showqycs').text(data.Data[0].outNum);


			var allSleepTime=MillisecondToDate((data.Data[0].deepSleepTime+data.Data[0].lightSleepTime)*1000);

			var deepSleepTime=MillisecondToDate((data.Data[0].deepSleepTime)*1000);

			var lightSleepTime=MillisecondToDate((data.Data[0].lightSleepTime)*1000);


			$('#sample-pb1').append('<p>深度睡眠时长:'+ deepSleepTime +'</p>');
			$('#sample-pb2').append('<p>浅度睡眠时长:'+ lightSleepTime +'</p>');
			$('#sample-pb3').append('<p>总睡眠时长:'+ allSleepTime +'</p>');

			//上床到开始睡眠比例

//				var num=((data.Data[0].goToBed)*1000/(data.Data[0].sleepEnd-data.Data[0].sleepStart))*100;

			var num=((data.Data[0].sleepStart-data.Data[0].goToBed)/(data.Data[0].outOfBed-data.Data[0].goToBed))*100;

			console.log(num);
			//深度睡眠比例
			var num1=((data.Data[0].deepSleepTime)/(data.Data[0].lightSleepTime+data.Data[0].deepSleepTime))*100;


			//浅度睡眠比例
			var num2=((data.Data[0].lightSleepTime)/(data.Data[0].lightSleepTime+data.Data[0].deepSleepTime))*100;

			var date_sleepStart = new Date(parseInt(data.Data[0].sleepStart));
			var date_fmt_sleepStart=date_sleepStart.format(" hh:mm");

			$('.number-pb.rumian').append('<span class="showgotoBed tosleep">'+date_fmt_sleepStart+'</span>');

			var date_goToBed = new Date(parseInt(data.Data[0].goToBed));
			var date_fmt_goToBed=date_goToBed.format(" hh:mm");
			$('.sc').append('<span class="showgotoBed">'+date_fmt_goToBed+'</span>');


			var date_outOfBed = new Date(parseInt(data.Data[0].outOfBed));
			var date_fmt_outOfBed=date_outOfBed.format(" hh:mm");
			$('.qc').append('<span class="showgotoBed outOfBed">'+date_fmt_outOfBed+'</span>');

			if(data.Data[0].score!=0){
				var num=20;
				var num3 = 100;
				var controlBar = $('#sample-pb .number-pb').NumberProgressBar({
					duration: 3000,
					percentage: num
				});

				var controlBar3 = $('#sample-pb3 .number-pb').NumberProgressBar({
					duration: 3000,
					percentage: num3
				});

			}else{


				var num = 0;

				var num3 = 0;
				var controlBar = $('#sample-pb .number-pb').NumberProgressBar({
					duration: 3000,
					percentage: num
				});

				var controlBar3 = $('#sample-pb3 .number-pb').NumberProgressBar({
					duration: 3000,
					percentage: num3
				});

			}



			var controlBar1 = $('#sample-pb1 .number-pb').NumberProgressBar({
				duration: 3000,
				percentage: num1
			});

			var controlBar2 = $('#sample-pb2 .number-pb').NumberProgressBar({
				duration: 3000,
				percentage: num2
			});


		},
		error: function (data) {
			console.log(data);
			var txt = data.Message;
			window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.confirm);
		}
	});


}
	})



</script>
<script>
	$(function() {



		function animate(val) {
			if (val < 0) {
				num = 0;
			} else if (val > 100) {
				num = 100;
			} else {
				num = val
			}
			controlBar.reach(num);
			controlBar1.reach(num1);
			controlBar2.reach(num2);
			controlBar3.reach(num3);
		}
	});

	//Using Instance


</script>
<script src="/RequestDisPatcher/JS/mine.js"></script>
</body>

