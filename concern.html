<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Family Concern</title>
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes" />
    <link rel="stylesheet" href="https://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="/RequestDisPatcher/JS/jquery-3.2.0.min.js"></script>
    <script src="/RequestDisPatcher/amcharts/amcharts.js"></script>
    <script src="/RequestDisPatcher/amcharts/serial.js"></script>
    <script src="/RequestDisPatcher/amcharts/themes/light.js"></script>
    <script src="/RequestDisPatcher/JS/xcConfirm.js"></script>
    <link rel="stylesheet" type="text/css" href="/RequestDisPatcher/CSS/xcConfirm.css"/>
    <link rel="stylesheet" type="text/css" href="/RequestDisPatcher/CSS/layout.css">
    <link rel="stylesheet" type="text/css" href="/RequestDisPatcher/CSS/global.css">
    <link rel="stylesheet" type="text/css" href="/RequestDisPatcher/CSS/font-awesome.min.css">
    <script type="text/javascript">
        $(document).ready(function(){
            var userInfo = document.cookie.match(new RegExp("(^| )userData=([^;]*)(;|$)"));
//            console.log(userInfo);
            var info = JSON.parse(userInfo[2]);
            console.log(info);
            var Info=info['userInfo'];
            var token = info.token;
            var myConcern;
            var concernMe;
            var applyConcern;

            function bindListener(){
                $('.concern_item1  .clickLi ').siblings().hide();
                $(".clickLi").unbind().each(function(index,item){

                    $(item).on("click",function(event){
                        $target=$(event.target);
                        var email=$('span:last-child',this).text();

                        $('i',this).bind('click',function(){
                            var txt="确定不关注此人？";
                            window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.confirm);
                        });
//                        $('i',this).click(function () {
//                            $.ajax({
//                                type:"POST",
//                                url:"/RequestDisPatcher/request/dispatcher.do",
//                                data:{
//                                    url:"http://127.0.0.1:9001/login/cancel",
//                                    params:"email="+email+"&type="+'myConcer'+"&token="+token
//                                },
//                                dataType:"json",
//                                success:function(data) {
//                                   console.log(data);
//                                    $(item).parents('.concern_item1').remove();
//                                },
//                                error: function (jqXHR, textStatus, errorThrown,Code) {
//                                    console.log(data);
//                                    alert("Unkonw Error.Please Try Again!");
//
//                                }
//                            })
//
//
//
//
//
//
//
//
//
//
//
//                        });

//                                .toggleClass('itme1_arrow').toggleClass('itme2_arrow');
                        $(this).siblings().toggle('item1_product_list');

                    });
                });

//                $(".clickLi .header_pic i .itme1_arrow").unbind().each(function(index,item){
//                    $(item).on("click",function(event){
//                        alert('remove');
//                        $target=$(event.target);
////                        $('i',this).toggleClass('itme1_arrow').toggleClass('itme2_arrow');
////                        $(this).siblings().toggle('item1_product_list');
//
//
//
//                    });
//                });

            }
            $.ajax({
                type:"post",
                url:"/RequestDisPatcher/request/dispatcher.do",
                data: {
                    url:"http://127.0.0.1:9001/login/getWait",
                    params:"token="+token

                },
                success: function (data) {
//                    console.log(data);
//                    $('.concern_item2').empty();
                    $.each(data.Data, function(i, item) {
                        $(".concern2 .concern201").append('<ul class="concern_item2"><div class="detail_pic"> <div class="header_pic"> <i class="itme1_arrow"></i> <img src="'+item.image+'" id="head">  <span class="name">'+item.firstName+'</span> <span class="email">'+item.email+'</span> </div> <i class="itme1_rabish"></i> </div> </ul>');
                    });
                },
                error: function (data) {
                    alert('faile');
                }
            });

            $.ajax({
                type:"post",
                url:"/RequestDisPatcher/request/dispatcher.do",
                data: {
                    url:"http://127.0.0.1:9001/login/getConcernMe",
                    params:"token="+token
                },
                success: function (data) {
//                    console.log(data);
//                    $('.concern_item2').empty();
                    $.each(data.Data, function(i, item) {
                        $(".concern2 .concern202").append('<ul class="concern_item2"> <div class="detail_pic"> <div class="header_pic"> <i class="itme1_arrow"></i>  <img src="'+item.image+'" id="head"> <span class="name">'+item.name+'</span> <span class="email">'+item.email+'</span> </div> <i class="itme1_rabish"></i> </div> </ul>');
                    });
                },
                error: function (data) {
                    alert('faile');
                }
            });
            $.ajax({
                type:"post",
                url:"/RequestDisPatcher/request/dispatcher.do",
                data: {
                    url:"http://127.0.0.1:9001/login/getMyConcern",
                    params:"token="+token
                },
                success: function (data) {
                    console.log(data);
//                    $('.concern_item1').empty();
                    $.each(data.Data, function(i, item) {

                        $(".concern1").append('<ul class="concern_item1"> <div class="detail_pic"> <li class="clickLi"> <div class="header_pic"> <i class="itme1_arrow" ></i>  <img src="' + item.image + '" id="head">  <span class="name">' + item.name + '</span> <span class="email">' + item.email + '</span> </div> <i class="itme1_rabish"></i> </li> <li> <div class="item1_product_list"> <ul> <li><span>智能床垫</span> <a href="real.html">查看实时数据</a> <a href="healthy.html">查看健康档案</a> </li> <li><span>智能枕</span> <a href="real.html?id=123">查看实时数据</a> <a href="healthy.html">查看健康档案</a> </li> <li><span>智能手环</span> <a href="real.html">查看实时数据</a> <a href="healthy.html">查看健康档案</a> </li> </ul> </div> </li> </div> </ul>');
                    });
                    bindListener();
                },
                error: function (data) {
                    alert('faile');
                }
            });
            function quit() {
                $.ajax({
                    type:"post",
                    url:"/RequestDisPatcher/request/dispatcher.do",
                    data: {
                        url:"http://127.0.0.1:9001/login/logout",
                        params:"token="+token
                    },
                    success: function (data) {
                        alert(data.Message);
//
                    },
                    error: function (data) {
                        alert('fail');
                    }
                });
            }
        });
    </script>
    <script type="text/javascript">
        function cancel_apply(){
            $("#search_result").remove();
        }
        function apply_apply(){
            var userInfo = document.cookie.match(new RegExp("(^| )userData=([^;]*)(;|$)"));
            var info = JSON.parse(userInfo[2]);
            var myEmail = info.Email;
            var firstName = info.firstName;
            var middleName = info.middleName;
            var lastName = info.lastName;
            var otherEmails = document.cookie.match(new RegExp("(^| )applyPeopleEmail=([^;]*)(;|$)"));
            var otherEmail = otherEmails[2];
            $.ajax({
                type:"post",
                url:"/SleepMonitor/concern/apply",
                data:{
                    myEmail:myEmail,
                    otherEmail:otherEmail,
                    firstName:firstName,
                    middleName:middleName,
                    lastName:lastName
                },
                dataType:"json",
                success:function(data){
                    if(data.Code==1013){
                        alert(data.Message);
                        javascript:location.reload();
                    }else{
                        alert(data.Message);
                    }
                },
                error:function(){
                    alert("Unkonw Error.Please Try Again!");
                }
            });
        }
        function agree(index){
            var userInfo = document.cookie.match(new RegExp("(^| )userData=([^;]*)(;|$)"));
            var info = JSON.parse(userInfo[2]);
            var myEmail = info.Email;
            var firstName = info.firstName;
            var middleName = info.middleName;
            var lastName = info.lastName;
            var applyInfo1 = document.cookie.match(new RegExp("(^| )applyUser"+index+"=([^;]*)(;|$)"));
            var otherName = applyInfo1[2];
            var applyInfo2 = document.cookie.match(new RegExp("(^| )applyEmail"+index+"=([^;]*)(;|$)"));
            var otherEmail = applyInfo2[2];
            $.ajax({
                type:"post",
                url:"/SleepMonitor/concern/agree",
                data:{
                    myEmail:myEmail,
                    otherEmail:otherEmail,
                    firstName:firstName,
                    middleName:middleName,
                    lastName:lastName,
                    otherName:otherName
                },
                dataType:"json",
                success:function(data){
                    if(data.Code==1015){
                        alert(data.Message);
                        javascript:location.reload();
                    }else{
                        alert(data.Message);
                    }
                },
                error:function(){
                    alert("Unkonw Error.Please Try Again!");
                }
            });
        }
        function disagree(index){
            var userInfo = document.cookie.match(new RegExp("(^| )userData=([^;]*)(;|$)"));
            var info = JSON.parse(userInfo[2]);
            var myEmail = info.Email;
            var applyInfo2 = document.cookie.match(new RegExp("(^| )applyEmail"+index+"=([^;]*)(;|$)"));
            var otherEmail = applyInfo2[2];
            $.ajax({
                type:"post",
                url:"/SleepMonitor/concern/disagree",
                data:{
                    myEmail:myEmail,
                    otherEmail:otherEmail
                },
                dataType:"json",
                success:function(data){
                    if(data.Code==1015){
                        alert(data.Message);
                        javascript:location.reload();
                    }else{
                        alert(data.Message);
                    }
                },
                error:function(){
                    alert("Unkonw Error.Please Try Again!");
                }
            });
        }
        function myConcernCancel(index){
            var userInfo = document.cookie.match(new RegExp("(^| )userData=([^;]*)(;|$)"));
            var info = JSON.parse(userInfo[2]);
            var myEmail = info.Email;
            var applyInfo2 = document.cookie.match(new RegExp("(^| )myconcernEmail"+index+"=([^;]*)(;|$)"));
            var otherEmail = applyInfo2[2];
            $.ajax({
                type:"post",
                url:"/SleepMonitor/concern/cancel",
                data:{
                    myEmail:myEmail,
                    otherEmail:otherEmail,
                    flog:"true"
                },
                dataType:"json",
                success:function(data){
                    if(data.Code==1017){
                        alert(data.Message);
                        javascript:location.reload();
                    }else{
                        alert(data.Message);
                    }
                },
                error:function(){
                    alert("Unkonw Error.Please Try Again!");
                }
            });
        }
        function concernMeConcel(index){
            var userInfo = document.cookie.match(new RegExp("(^| )userData=([^;]*)(;|$)"));
            var info = JSON.parse(userInfo[2]);
            var myEmail = info.Email;
            var applyInfo2 = document.cookie.match(new RegExp("(^| )concernMeEmail"+index+"=([^;]*)(;|$)"));
            var otherEmail = applyInfo2[2];
            $.ajax({
                type:"post",
                url:"/SleepMonitor/concern/cancel",
                data:{
                    myEmail:myEmail,
                    otherEmail:otherEmail,
                    flog:"false"
                },
                dataType:"json",
                success:function(data){
                    if(data.Code==1017){
                        alert(data.Message);
                        javascript:location.reload();
                    }else{
                        alert(data.Message);
                    }
                },
                error:function(){
                    alert("Unkonw Error.Please Try Again!");
                }
            });
        }
    </script>

</head>
<body>
<div class="holder">
    <div class="left_nav contest">
        <div class="header_text">
            <div class="header_text_right">
                <span class="header_pic"><a href="modify.html" ><img src="Heads/header_woman.png" id="head"></a></span>
            </div>
        </div>
        <ul>
            <a href="login.html"><li onclick="quit()"  >退出登录</li></a>
            <a href="concern.html"><li class="on">亲请关注</li></a>
            <a href="productupgrade.html"><li>增值服务</li></a>
            <a href="" ><span title="Yet open, please wait patiently"><li>名医坐堂</li></span></a>
        </ul>
    </div>
    <div class="right_show">
        <h2>isleep</h2>
        <a href="homepage.html"><span class="glyphicon glyphicon-home"></span></a>
        <div class="show_detail">
            <div class="show_detail_data">
                <ul class="concern_list">
                    <li><span>关注申请</span></li>
                    <li><span>我的关注</span></li>
                    <li><span>关注我的</span></li>
                </ul>
                <div class="concern0">
                    <div class="left" >
                        <div class="panel_input item0_input">
                            <input type="email" class="" id="apply_txt"/>
                            <input type="button" class="search_btn" id="search_btn" >
                            <!--<img src="images/search.png" class="search_pic"/>-->
                        </div>
                    </div>
                </div>
                <div class="concern1"></div>
                <div class="concern2">
                    <div class="concern201"><h4>批准申请</h4> </div>
                    <div class="concern202"><h4>我的关注</h4> </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $('#search_btn').bind("click",function(){
        var userInfo = document.cookie.match(new RegExp("(^| )userData=([^;]*)(;|$)"));
        console.log(userInfo);
        var info = JSON.parse(userInfo[2]);
        var Info=info['userInfo'];
        var token = info.token;
        var approval_box0_email = $("#apply_txt").val();
        if ($.trim(approval_box0_email) == '') {
            alert("input email!");
            return false;
        }
        else{
            $.ajax({
                        type:"POST",
                        url:"/RequestDisPatcher/request/dispatcher.do",
                        data:{
                            url:"http://127.0.0.1:9001/login/query",
                            params:"email="+approval_box0_email
                        },
                        dataType:"json",
                        success:function(data) {
                            if(data.Code==1){
                                $(".concern_item0").remove();

                                $(".concern0").append(' <ul class="concern_item0"> <div  class="concern_someone_detail"> <div class="detail_pic"> <span class="header_pic"><img src="' + data.Data.image + '" id="head">  <p class="appl_name">' + data.Data.name + '</p> <p class="appl_email">' + data.Data.email + '</p> </span> <div class="detail_btn"> <input type="button" name="Submit" onclick="javascript:history.back(-1);" value="Back" class="submit_back"> <input type="button" value="Submit" id="submit_submit" class="submit_submit"> </div> </div> </div> </ul> ');

                                $("#submit_submit").click(function () {
                                    $.ajax({
                                        type:"POST",
                                        url:"/RequestDisPatcher/request/dispatcher.do",
                                        data:{
                                            url:"http://127.0.0.1:9001/login/apply",
                                            params:"token="+token+"&email="+approval_box0_email
                                        },
                                        dataType:"json",
                                        success:function(data) {
                                            alert(data.Message);
                                        },
                                        error: function (jqXHR, textStatus, errorThrown,Code) {
                                            alert("Unkonw Error.Please Try Again!");
                                        }
                                    })
                                });
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown,Code) {
                            alert("Unkonw Error.Please Try Again!");
                        }
                    }
            );}
    });
</script>
<!--<script src="/SleepMonitor/JS/mine.js"></script>-->
<script src="/RequestDisPatcher/JS/mine.js"></script>
</body>
</html>